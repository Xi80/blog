<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<title>MC68000��C������ | Vide</title>


<link rel="stylesheet" href="/styles/main.css">


    <meta name="generator" content="Hexo 6.3.0"></head>
    <body>
        <div class="container">
            <header>
<div class="main">
<div class="title">
    <a href="#" class="logo">Vide</a>
</div>
<div class="site-nav">
    <ul id="menu" class="menu">
    
        <li class="menu-item text-underline">
            <a href="/">ホーム</a>
        </li>
    
        <li class="menu-item text-underline">
            <a href="/archives">記事</a>
        </li>
    
        <li class="menu-item text-underline">
            <a href="/about/">About</a>
        </li>
            
    </ul>
</div>
</div>
</header>
            <main class="main">
                <section class="posts clearfix">
<div class="post-wrapper">
    <article class="post article-entry">
    <div class="post-title">
        MC68000��C������
    </div>
    <p class="sub">11月 28 2022</p>
    <div class="post-content">
        <h2 id="�͂��߂�"><a href="#�͂��߂�" class="headerlink" title="�͂��߂�"></a>�͂��߂�</h2><p>�Ƃ肠�������̎��_�ŏ�肭�s�������@�������Ă܂����A�K���ɍX�V���Ă�������ł��B</p>
<p>�����gcc9.5.0���r���h����MC68000��C�̃R�[�h�𑖂点����@�������Ă����܂��B</p>
<h2 id="gcc�̃r���h"><a href="#gcc�̃r���h" class="headerlink" title="gcc�̃r���h"></a>gcc�̃r���h</h2><p><a target="_blank" rel="noopener" href="https://github.com/ddraig68k/m68k-elf-toolchain">���̃��|�W�g��</a>�̓��e�ɏ]�������ł��B</p>
<p>�ŏ���Cygwin�ł�낤�Ǝv���܂������r���ŃR�P���̂�MSYS2�𓱓����ăr���h�B</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">admin@LUNAEDGE-X260 MSYS ~</span><br><span class="line">$ m68k-elf-gcc -v</span><br><span class="line">Using built-in specs.</span><br><span class="line">COLLECT_GCC=m68k-elf-gcc</span><br><span class="line">COLLECT_LTO_WRAPPER=/opt/m68k-elf/libexec/gcc/m68k-elf/9.5.0/lto-wrapper</span><br><span class="line">Target: m68k-elf</span><br><span class="line">Configured with: /home/admin/m68k-elf-toolchain/projects/gcc/configure --prefix=/opt/m68k-elf --target=m68k-elf --enable-languages=c,c++,lto --enable-version-specific-runtime-libs --disable-libssp --disable-nls --disable-threads --disable-libmudflap --disable-libgomp --disable-libstdcxx-pch --with-gnu-as --with-gnu-ld --with-newlib --with-headers=/home/admin/m68k-elf-toolchain/projects/newlib-cygwin/newlib/libc/include/ --disable-shared --src=../../projects/gcc</span><br><span class="line">Thread model: single</span><br><span class="line">gcc version 9.5.0 (GCC)</span><br></pre></td></tr></table></figure>

<p>����Ȋ����ɂȂ�܂�(PATH�������ƒʂ��Ă���)�B</p>
<h2 id="�X�-�-�g�A�b�v�X�N���v�g"><a href="#�X�-�-�g�A�b�v�X�N���v�g" class="headerlink" title="�X�^�[�g�A�b�v�X�N���v�g"></a>�X�^�[�g�A�b�v�X�N���v�g</h2><p>����������<a target="_blank" rel="noopener" href="https://kikb.web.fc2.com/">Ki����</a>�ɏ�������Ȃ���쐬���܂����B</p>
<p>���̏���؂�Ċ��Ӑ\���グ�܂��B</p>
<p>����͋ɗ̓A�Z���u�����g�킸�ɃX�^�[�g�A�b�v���[�&#96;�����L�q���܂��B</p>
<p>���荞�݃x�N�^���ŏ������������܂���B</p>
<p>�Œ�������R�[�h��������</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">uint32_t</span> __stack_top;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> _init_board(<span class="type">void</span>);</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> _reset_handler(<span class="type">void</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="keyword">volatile</span> <span class="type">uintptr_t</span> vectors[]</span><br><span class="line">__attribute__((section(<span class="string">&quot;.isr_vector&quot;</span>))) = &#123;</span><br><span class="line">	<span class="comment">/*Reset: Initial SSP*/</span></span><br><span class="line">	(<span class="type">uintptr_t</span>)(&amp;__stack_top),</span><br><span class="line">	<span class="comment">/*Reset: Initial PC*/</span></span><br><span class="line">	(<span class="type">uintptr_t</span>)(&amp;_reset_handler)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> _init_board(<span class="type">void</span>)&#123;</span><br><span class="line">	<span class="comment">/*Do nothing*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> _memcpy(<span class="type">uint8_t</span>* dst,<span class="type">uint8_t</span>* src,<span class="type">size_t</span> size)&#123;</span><br><span class="line">	<span class="keyword">while</span> (size--) &#123;</span><br><span class="line">	    *dst++ = *src++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> _memclr(<span class="type">uint8_t</span>* dst,<span class="type">size_t</span> size)&#123;</span><br><span class="line">	<span class="keyword">while</span> (size--) &#123;</span><br><span class="line">	    *dst++ = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> _reset_handler(<span class="type">void</span>)&#123;</span><br><span class="line">	_init_board();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*Xfer Init Value*/</span></span><br><span class="line">	<span class="keyword">extern</span> <span class="type">uint8_t</span> __data_top,__data_bottom,__text_bottom;</span><br><span class="line">	<span class="type">size_t</span> size = (<span class="type">size_t</span>)(&amp;__data_bottom - &amp;__data_top);</span><br><span class="line">	_memcpy(&amp;__data_top,&amp;__text_bottom,size);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*Memory Clear*/</span></span><br><span class="line">	<span class="keyword">extern</span> <span class="type">uint8_t</span> __bss_bottom,__bss_top;</span><br><span class="line">	size = (<span class="type">size_t</span>)(&amp;__bss_bottom - &amp;__bss_top);</span><br><span class="line">	_memclr(&amp;__bss_top,size);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*Call main()*/</span></span><br><span class="line">	main();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>�X�^�[�g�A�b�v���[�&#96;���ł�</p>
<ul>
<li>�{�[�h�̏�����</li>
<li>�ϐ��̏����l�ݒ�</li>
<li>main(�G���g���|�C���g)�ւ̃W�����v</li>
</ul>
<p>���s���܂��B</p>
<p>�����ŁAmain�֐��͕ʃt�@�C����extern�錾����Ă��܂��B</p>
<p>MC68k�̃x�N�^��0�Ԃ�SSP�����l�A1�Ԃ�PC�����l������܂��B</p>
<h2 id="�����J�X�N���v�g"><a href="#�����J�X�N���v�g" class="headerlink" title="�����J�X�N���v�g"></a>�����J�X�N���v�g</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">		Ricochet�pBootloader �����J�X�N���v�g</span><br><span class="line">		2022.11.23 c0ntra1l</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">		�������&#125;�b�v(Bootloader���s��)</span><br><span class="line">		0x000000 - 0x7FFFFF	Flash*</span><br><span class="line">		0x100000 - 0x13FFFF	RAM(�f�[�^)</span><br><span class="line">		0x200000 - 0x23FFFF	RAM(�v���O����)</span><br><span class="line"></span><br><span class="line">		�������&#125;�b�v(���[�U�[�v���O�������s��)</span><br><span class="line">		0x000000 - 0x13FFFF	RAM(�v���O����)*</span><br><span class="line">		0x100000 - 0x23FFFF	RAM(�f�[�^)</span><br><span class="line"></span><br><span class="line">		*:���s����v���O����</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">MEMORY &#123;</span><br><span class="line">	vec (r)		:	ORIGIN = 0x000000,	LENGTH = 0x400</span><br><span class="line">	rom	(xr)	:	ORIGIN = 0x000400,	LENGTH = 512K - 0x400</span><br><span class="line">	ram	(rw)	:	ORIGIN = 0x100000,	LENGTH = 256K</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SECTIONS &#123;</span><br><span class="line">	/*�x�N�^*/</span><br><span class="line">	.isr_vector : &#123;</span><br><span class="line">		__rom_top = .;</span><br><span class="line">		__rom_vec	= .;</span><br><span class="line">	&#125; &gt; vec</span><br><span class="line"></span><br><span class="line">	/*.text�Z�N�V����*/</span><br><span class="line">	.text : &#123;</span><br><span class="line">		__text_top = .;</span><br><span class="line">		*(.text*)</span><br><span class="line">		__text_bottom = .;</span><br><span class="line">		*(.rodata*)</span><br><span class="line">	&#125; &gt; rom</span><br><span class="line"></span><br><span class="line">	/*.data�Z�N�V����*/</span><br><span class="line">	.data :</span><br><span class="line">	&#123;</span><br><span class="line">		__data_top = .;</span><br><span class="line">		*(.data)</span><br><span class="line">		__data_bottom = .;</span><br><span class="line">	&#125; &gt; ram</span><br><span class="line"></span><br><span class="line">	/*.bss�Z�N�V����*/</span><br><span class="line">	.bss :</span><br><span class="line">	&#123;</span><br><span class="line">		__bss_top = .;</span><br><span class="line">		*(.bss)</span><br><span class="line">		*(COMMON)</span><br><span class="line">		__bss_bottom = .;</span><br><span class="line">		__stack_top = .;</span><br><span class="line">	&#125; &gt; ram</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>�������z�u���<code>���܂��Bhoge_top��hoge_bottom�̓X�^�[�g�A�b�v���[�</code>���œ]��(������)���郁�����̗̈�v�Z�Ɏg�p���܂��B</p>
<p>.data�Z�N�V�����������l����ϐ��A.bss�Z�N�V�����������l�Ȃ��ϐ��A.text���v���O�����A.rodata�������l����ϐ��̏����l������̈�̂悤�ł��B</p>
<h2 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">prefix		= m68k-elf-</span><br><span class="line">CC			= <span class="variable">$(prefix)</span>gcc</span><br><span class="line">AS			= <span class="variable">$(prefix)</span>as</span><br><span class="line">LD			= <span class="variable">$(prefix)</span>ld</span><br><span class="line">OBJCOPY		= <span class="variable">$(prefix)</span>objcopy</span><br><span class="line">OBJDUMP		= <span class="variable">$(prefix)</span>objdump</span><br><span class="line">RM			= rm</span><br><span class="line"></span><br><span class="line">PROJECT		= r68k_bootloader</span><br><span class="line">PROGRAM 	= <span class="variable">$(PROJECT)</span>.elf</span><br><span class="line">TARGET_S	= <span class="variable">$(PROJECT)</span>.s68</span><br><span class="line">TARGET_B	= <span class="variable">$(PROJECT)</span>.bin</span><br><span class="line"></span><br><span class="line">CFLAGS		= -g -O2 -m68000 -Wall -fomit-frame-pointer</span><br><span class="line">LDFLAGS 	= -Map <span class="variable">$(PROJECT)</span>.map -T ricochet.lds -nostdlib</span><br><span class="line"></span><br><span class="line">MAKEFILE	= Makefile</span><br><span class="line"></span><br><span class="line">OBJS		= main.o startup.o</span><br><span class="line"></span><br><span class="line">LIBS		=</span><br><span class="line"></span><br><span class="line"><span class="section">all:		<span class="variable">$(TARGET_B)</span> <span class="variable">$(TARGET_S)</span></span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(TARGET_B)</span>: <span class="variable">$(PROGRAM)</span></span><br><span class="line">	<span class="variable">$(OBJCOPY)</span> -O binary --remove-section=.data <span class="variable">$(PROGRAM)</span> <span class="variable">$(TARGET_B)</span></span><br><span class="line">	@echo &#x27;-------------------------------------------------------------------&#x27;</span><br><span class="line">	@echo <span class="string">&quot; <span class="variable">$(TARGET_B)</span> build succeeded. [`date`]&quot;</span></span><br><span class="line">	@echo &#x27;&#x27;</span><br><span class="line"></span><br><span class="line"><span class="variable">$(TARGET_S)</span>: <span class="variable">$(PROGRAM)</span></span><br><span class="line">	<span class="variable">$(OBJCOPY)</span> -O srec --remove-section=.data <span class="variable">$(PROGRAM)</span> <span class="variable">$(TARGET_S)</span></span><br><span class="line">	<span class="variable">$(OBJDUMP)</span> -D <span class="variable">$(PROGRAM)</span> &gt;<span class="variable">$(PROGRAM)</span>.dasm</span><br><span class="line">	<span class="variable">$(OBJDUMP)</span> -h <span class="variable">$(PROGRAM)</span></span><br><span class="line">	@echo &#x27;-------------------------------------------------------------------&#x27;</span><br><span class="line">	@echo <span class="string">&quot; <span class="variable">$(TARGET_S)</span> build succeeded. [`date`]&quot;</span></span><br><span class="line">	@echo &#x27;&#x27;</span><br><span class="line"></span><br><span class="line"><span class="variable">$(PROGRAM)</span>: 	<span class="variable">$(OBJS)</span> <span class="variable">$(LIBS)</span></span><br><span class="line">		<span class="variable">$(LD)</span> <span class="variable">$(LDFLAGS)</span> -o <span class="variable">$(PROGRAM)</span> <span class="variable">$(OBJS)</span></span><br><span class="line"></span><br><span class="line"><span class="section">%.o:		%.c</span></span><br><span class="line">		<span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> -c <span class="variable">$&lt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	<span class="variable">$(RM)</span> -f <span class="variable">$(PROGRAM)</span></span><br><span class="line">	<span class="variable">$(RM)</span> -f <span class="variable">$(TARGET_S)</span></span><br><span class="line">	<span class="variable">$(RM)</span> -f <span class="variable">$(TARGET_B)</span></span><br><span class="line">	<span class="variable">$(RM)</span> -f *.o</span><br><span class="line"></span><br><span class="line"><span class="section">tar:</span></span><br><span class="line">	cd .. &amp;&amp; tar czvf <span class="variable">$(PROJECT)</span>-`date &#x27;+%Y%m%d&#x27;`.tar.gz <span class="variable">$(PROJECT)</span></span><br></pre></td></tr></table></figure>

<p>����̓V�~�����[�^�ł̃e�X�g�p��bin�t�@�C�������łȂ�S���R�[�h���o�͂��Ă��܂��B<br>�܂��Agcc�̃I�v�V������<code>-fomit-frame-pointer</code>���w�肵�A�t���[���|�C���^���g�p���Ȃ��悤�ɂ��Ă��܂��B</p>
<p>##�@�e�X�g�v���O����</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;startup.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">signed</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">uint8_t</span> <span class="built_in">array</span>[<span class="number">128</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">signed</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">uint8_t</span> i = <span class="number">0</span>;i &lt; <span class="number">128</span>;i++)&#123;</span><br><span class="line">		<span class="built_in">array</span>[i] = i;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>�R���p�C���ł��邱�Ƃ��&#96;�F�b�N���邽�߂ɓK���ȃv���O�������ł��������܂����B</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">admin@LUNAEDGE-X260 MSYS /c/Users/Admin/Documents/Bootloader_68k</span><br><span class="line">$ make all</span><br><span class="line">m68k-elf-gcc -g -O2 -m68000 -Wall -fomit-frame-pointer -c main.c</span><br><span class="line">m68k-elf-gcc -g -O2 -m68000 -Wall -fomit-frame-pointer -c startup.c</span><br><span class="line">startup.c: In <span class="keyword">function</span> <span class="string">&#x27;_reset_handler&#x27;</span>:</span><br><span class="line">startup.c:47:2: warning: implicit declaration of <span class="keyword">function</span> <span class="string">&#x27;main&#x27;</span> [-Wimplicit-function-declaration]</span><br><span class="line">   47 |  main();</span><br><span class="line">      |  ^~~~</span><br><span class="line">m68k-elf-ld -Map r68k_bootloader.map -T ricochet.lds -nostdlib -o r68k_bootloader.elf main.o startup.o</span><br><span class="line">m68k-elf-objcopy -O binary --remove-section=.data r68k_bootloader.elf r68k_bootloader.bin</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line"> r68k_bootloader.bin build succeeded. [Mon Nov 28 08:01:45 JST 2022]</span><br><span class="line"></span><br><span class="line">m68k-elf-objcopy -O srec --remove-section=.data r68k_bootloader.elf r68k_bootloader.s68</span><br><span class="line">m68k-elf-objdump -D r68k_bootloader.elf &gt;r68k_bootloader.elf.dasm</span><br><span class="line">m68k-elf-objdump -h r68k_bootloader.elf</span><br><span class="line"></span><br><span class="line">r68k_bootloader.elf:     file format elf32-m68k</span><br><span class="line"></span><br><span class="line">Sections:</span><br><span class="line">Idx Name          Size      VMA       LMA       File off  Algn</span><br><span class="line">  0 .isr_vector   00000008  00000000  00000000  00002000  2**1</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, DATA</span><br><span class="line">  1 .text         00000064  00000400  00000400  00002400  2**2</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, READONLY, CODE</span><br><span class="line">  2 .bss          00000080  00100000  00100000  00004000  2**2</span><br><span class="line">                  ALLOC</span><br><span class="line">  3 .debug_info   0000149d  00000000  00000000  00002464  2**0</span><br><span class="line">                  CONTENTS, READONLY, DEBUGGING</span><br><span class="line">  4 .debug_abbrev 000004b9  00000000  00000000  00003901  2**0</span><br><span class="line">                  CONTENTS, READONLY, DEBUGGING</span><br><span class="line">  5 .debug_loc    00000116  00000000  00000000  00003dba  2**0</span><br><span class="line">                  CONTENTS, READONLY, DEBUGGING</span><br><span class="line">  6 .debug_aranges 00000040  00000000  00000000  00003ed0  2**0</span><br><span class="line">                  CONTENTS, READONLY, DEBUGGING</span><br><span class="line">  7 .debug_ranges 00000028  00000000  00000000  00003f10  2**0</span><br><span class="line">                  CONTENTS, READONLY, DEBUGGING</span><br><span class="line">  8 .debug_line   00000336  00000000  00000000  00003f38  2**0</span><br><span class="line">                  CONTENTS, READONLY, DEBUGGING</span><br><span class="line">  9 .debug_str    0000054d  00000000  00000000  0000426e  2**0</span><br><span class="line">                  CONTENTS, READONLY, DEBUGGING</span><br><span class="line"> 10 .comment      00000011  00000000  00000000  000047bb  2**0</span><br><span class="line">                  CONTENTS, READONLY</span><br><span class="line"> 11 .debug_frame  00000048  00000000  00000000  000047cc  2**2</span><br><span class="line">                  CONTENTS, READONLY, DEBUGGING</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line"> r68k_bootloader.s68 build succeeded. [Mon Nov 28 08:01:45 JST 2022]</span><br></pre></td></tr></table></figure>

<p><code>make all</code>�����s����Ƃ��̂悤�ɂȂ�܂��B</p>
<p>Warning���o�Ă��܂����A�R���̓A�Z���u�����g��Ȃ��悤�ɂ��邽�߂�<code>asm(&quot;jmp main&quot;)</code>�̂�����<code>main()</code>�Ƃ������߂ł��B</p>
<p>�t�A�Z���u�������Ă݂��</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">r68k_bootloader.elf:     file format elf32-m68k</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .isr_vector:</span><br><span class="line"></span><br><span class="line">00000000 &lt;vectors&gt;:</span><br><span class="line">   0:	0010 0080      	orib #-128,%a0@</span><br><span class="line">   4:	0000 0418      	orib #24,%d0</span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line">00000400 &lt;main&gt;:</span><br><span class="line"> 400:	41f9 0010 0000 	lea 100000 &lt;__data_bottom&gt;,%a0</span><br><span class="line"> 406:	4200           	clrb %d0</span><br><span class="line"> 408:	10c0           	moveb %d0,%a0@+</span><br><span class="line"> 40a:	5200           	addqb #1,%d0</span><br><span class="line"> 40c:	0c00 ff80      	cmpib #-128,%d0</span><br><span class="line"> 410:	66f6           	bnes 408 &lt;main+0x8&gt;</span><br><span class="line"> 412:	7000           	moveq #0,%d0</span><br><span class="line"> 414:	4e75           	rts</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">00000418 &lt;_reset_handler&gt;:</span><br><span class="line"> 418:	203c 0010 0000 	movel #1048576,%d0</span><br><span class="line"> 41e:	0480 0010 0000 	subil #1048576,%d0</span><br><span class="line"> 424:	6718           	beqs 43e &lt;_reset_handler+0x26&gt;</span><br><span class="line"> 426:	43f9 0010 0000 	lea 100000 &lt;__data_bottom&gt;,%a1</span><br><span class="line"> 42c:	0680 0000 0464 	addil #1124,%d0</span><br><span class="line"> 432:	41f9 0000 0464 	lea 464 &lt;__text_bottom&gt;,%a0</span><br><span class="line"> 438:	12d8           	moveb %a0@+,%a1@+</span><br><span class="line"> 43a:	b1c0           	cmpal %d0,%a0</span><br><span class="line"> 43c:	66fa           	bnes 438 &lt;_reset_handler+0x20&gt;</span><br><span class="line"> 43e:	203c 0010 0080 	movel #1048704,%d0</span><br><span class="line"> 444:	0480 0010 0000 	subil #1048576,%d0</span><br><span class="line"> 44a:	6710           	beqs 45c &lt;_reset_handler+0x44&gt;</span><br><span class="line"> 44c:	41f9 0010 0000 	lea 100000 &lt;__data_bottom&gt;,%a0</span><br><span class="line"> 452:	4218           	clrb %a0@+</span><br><span class="line"> 454:	b1fc 0010 0080 	cmpal #1048704,%a0</span><br><span class="line"> 45a:	66f6           	bnes 452 &lt;_reset_handler+0x3a&gt;</span><br><span class="line"> 45c:	4eb9 0000 0400 	jsr 400 &lt;main&gt;</span><br><span class="line"> 462:	60fe           	bras 462 &lt;_reset_handler+0x4a&gt;</span><br><span class="line"></span><br><span class="line">Disassembly of section .bss:</span><br><span class="line"></span><br><span class="line">00100000 &lt;array&gt;:</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>

<p>���Ȃ��R���p�C���ł��Ă���悤�ł��B</p>
<p>���낢��C�ɂȂ�Ƃ���͂���܂����A�Ƃ肠�����������̂ł悵�Ƃ��܂��傤�B</p>
<p>�����͎��@�œ������Ă���ł��ˁB</p>
<h2 id="�V�-�����-�-�b˂�����"><a href="#�V�-�����-�-�b˂�����" class="headerlink" title="�V�~�����[�^�ɓ˂�����"></a>�V�~�����[�^�ɓ˂�����</h2><p>S68���V�~�����[�^�ɐH�킹��PC��0x000418�ɃZ�b�g�A���点�ă�������&#96;���Ă݂�Ƃ���Ȋ����ɂȂ��Ă܂��B</p>
<img src="/2022/11/28/mc68k-c/pgm_run.jpg" class="" title="[mc68k-c]">

<p>���Ȃ������ł��ˁB</p>
<h2 id="�v�����"><a href="#�v�����" class="headerlink" title="�v�����_"></a>�v�����_</h2><p>�����MC68k�̃V�~�����[�^��<a target="_blank" rel="noopener" href="http://www.easy68k.com/">EASy68k</a>���g���܂����B</p>
<p>�Ȃ��Ȃ��g���₷���ėǂ��̂ł����A���낢��s���_������܂��B</p>
<ul>
<li>�x�N�^��ǂ܂Ȃ�(�J�n�A�h���X��0x400�ASSP��0x100000�Œ���ۂ��H)</li>
<li>S68�����ł͋t�A�Z���u�����\������Ȃ�(L68���K�v�炵���A�ǂ�����΂����H)</li>
</ul>
<p>�O�҂͒���PC�����������ă��Z�b�g�n���h���ɔ�ׂ΂����̂ł܂��Ȃ�Ƃ��Ȃ�܂����A��҂͂��Ȃ茵�����ł��B</p>
<p>���͉��ɋt�A�Z���u�����X�g���o���āA�ڎ��Ńf�o�b�O�����Ă��܂����K�͂��傫���Ȃ�Ƃ��ꂷ�����ςɂȂ肻���ł��B</p>
<p>�Ȃ�Ƃ��Ȃ�Ȃ����̂ł��傤��…</p>
<p>�����B</p>

    </div>
    </article>
</div>

    <div class="_toc">
        <strong class="toc-title">
        Contents
        </strong>
        <div class="toc-content">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BF%BD%CD%82%EF%BF%BD%EF%BF%BD%DF%82%EF%BF%BD"><span class="toc-text">�͂��߂�</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gcc%EF%BF%BD%CC%83r%EF%BF%BD%EF%BF%BD%EF%BF%BDh"><span class="toc-text">gcc�̃r���h</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BF%BDX%EF%BF%BD-%EF%BF%BD-%EF%BF%BDg%EF%BF%BDA%EF%BF%BDb%EF%BF%BDv%EF%BF%BDX%EF%BF%BDN%EF%BF%BD%EF%BF%BD%EF%BF%BDv%EF%BF%BDg"><span class="toc-text">�X�^�[�g�A�b�v�X�N���v�g</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BDJ%EF%BF%BDX%EF%BF%BDN%EF%BF%BD%EF%BF%BD%EF%BF%BDv%EF%BF%BDg"><span class="toc-text">�����J�X�N���v�g</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Makefile"><span class="toc-text">Makefile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BF%BDV%EF%BF%BD-%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD-%EF%BF%BD-%EF%BF%BDb%CB%82%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD"><span class="toc-text">�V�~�����[�^�ɓ˂�����</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BF%BDv%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD"><span class="toc-text">�v�����_</span></a></li></ol>
        </div>
    </div>

</section>


    <nav class="post-nav">
        
            <div class="page-tags">
                
                    <a href="/tags/MC68000/">MC68000</a>
                
            </div>
        
    </nav>



    <nav class="paginator clearfix">
        
        
            <a class="next" href="/2022/11/28/made-blog/">
                
                <span class="prev-text">ブログ作った</span>
                <i class="iconfont icon-right"></i>
            </a>
        
    </nav>


            </main>
            <div class="copyright">
  <div class="text">Powered By
    <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> | Theme <a target="_blank" rel="noopener" href="https://github.com/Xi80/hexo-theme-Tsu_Revised">Tsu Revised</a> &copy 2022
  </div>
</div>

        </div>
    <div class="back-to-top" id="back-to-top">
            <i class="iconfont icon-up"></i>
    </div>
        
    </body>
    
<script src="/js/jquery-3.3.1.min.js"></script>

    
<script src="/js/back-to-top.js"></script>

    
<script src="/js/scroll.js"></script>

    <!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": { 
        preferredFont: "TeX", 
        availableFonts: ["STIX","TeX"], 
        linebreaks: { automatic:true }, 
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) 
    },
    tex2jax: { 
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ], 
        processEscapes: true, 
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {  
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } }, 
        Macros: { href: "{}" } 
    },
    messageStyle: "none"
    }); 
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

</html>
